{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar _jsxFileName = \"E:\\\\MediKeep\\\\screens\\\\Auth\\\\index.jsx\";\nimport React from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport firebase from \"firebase\";\n\nvar Auth = function Auth(_ref) {\n  var navigation = _ref.navigation;\n  firebase.auth().onAuthStateChanged(function (user) {\n    if (user != null) {\n      console.log(\"We are authenticated now!\");\n    }\n  });\n\n  var isUserEqual = function isUserEqual(googleUser, firebaseUser) {\n    if (firebaseUser) {\n      var providerData = firebaseUser.providerData;\n\n      for (var i = 0; i < providerData.length; i++) {\n        if (providerData[i].providerId === firebase.auth.GoogleAuthProvider.PROVIDER_ID && providerData[i].uid === googleUser.getBasicProfile().getId()) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  var onSignIn = function onSignIn(googleUser) {\n    console.log(\"Google Auth Response\", googleUser);\n    var unsubscribe = firebase.auth().onAuthStateChanged(function (firebaseUser) {\n      unsubscribe();\n\n      if (!isUserEqual(googleUser, firebaseUser)) {\n        var credential = firebase.auth.GoogleAuthProvider.credential(googleUser.idToken, googleUser.accessToken);\n        firebase.auth().signInAndRetrieveDataWithCredential(credential).then(function (result) {\n          console.log(\"user signed in \");\n\n          if (result.additionalUserInfo.isNewUser) {\n            firebase.database().ref(\"/users/\" + result.user.uid).set({\n              gmail: result.user.email,\n              profile_picture: result.additionalUserInfo.profile.picture,\n              first_name: result.additionalUserInfo.profile.given_name,\n              last_name: result.additionalUserInfo.profile.family_name,\n              created_at: Date.now()\n            }).then(function (snapshot) {});\n          } else {\n            firebase.database().ref(\"/users/\" + result.user.uid).update({\n              last_logged_in: Date.now()\n            });\n          }\n        }).catch(function (error) {\n          var errorCode = error.code;\n          var errorMessage = error.message;\n          var email = error.email;\n          var credential = error.credential;\n        });\n      } else {\n        console.log(\"User already signed-in Firebase.\");\n      }\n    });\n  };\n\n  var signInWithGoogleAsync = function signInWithGoogleAsync() {\n    var result;\n    return _regeneratorRuntime.async(function signInWithGoogleAsync$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(Expo.Google.logInAsync({\n              behavior: \"web\",\n              iosClientId: \"\",\n              scopes: [\"profile\", \"email\"]\n            }));\n\n          case 3:\n            result = _context.sent;\n\n            if (!(result.type === \"success\")) {\n              _context.next = 9;\n              break;\n            }\n\n            onSignIn(result);\n            return _context.abrupt(\"return\", result.accessToken);\n\n          case 9:\n            return _context.abrupt(\"return\", {\n              cancelled: true\n            });\n\n          case 10:\n            _context.next = 15;\n            break;\n\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](0);\n            return _context.abrupt(\"return\", {\n              error: true\n            });\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 12]], Promise);\n  };\n\n  return React.createElement(View, {\n    style: {\n      flex: 1,\n      alignItems: \"center\",\n      justifyContent: \"center\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 5\n    }\n  }, React.createElement(Button, {\n    title: \"Sign in with Google\",\n    onPress: function onPress() {\n      signInWithGoogleAsync();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default Auth;","map":{"version":3,"sources":["E:/MediKeep/screens/Auth/index.jsx"],"names":["React","firebase","Auth","navigation","auth","onAuthStateChanged","user","console","log","isUserEqual","googleUser","firebaseUser","providerData","i","length","providerId","GoogleAuthProvider","PROVIDER_ID","uid","getBasicProfile","getId","onSignIn","unsubscribe","credential","idToken","accessToken","signInAndRetrieveDataWithCredential","then","result","additionalUserInfo","isNewUser","database","ref","set","gmail","email","profile_picture","profile","picture","first_name","given_name","last_name","family_name","created_at","Date","now","snapshot","update","last_logged_in","catch","error","errorCode","code","errorMessage","message","signInWithGoogleAsync","Expo","Google","logInAsync","behavior","iosClientId","scopes","type","cancelled","flex","alignItems","justifyContent"],"mappings":"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","sourcesContent":["import React from \"react\";\r\n\r\nimport { View, Button } from \"react-native\";\r\nimport firebase from \"firebase\";\r\n\r\nconst Auth = ({ navigation }) => {\r\n  // Check if user is already logged In.\r\n  firebase.auth().onAuthStateChanged((user) => {\r\n    if (user != null) {\r\n      console.log(\"We are authenticated now!\");\r\n    }\r\n\r\n    // Do other things\r\n  });\r\n\r\n  const isUserEqual = (googleUser, firebaseUser) => {\r\n    if (firebaseUser) {\r\n      var providerData = firebaseUser.providerData;\r\n      for (var i = 0; i < providerData.length; i++) {\r\n        if (\r\n          providerData[i].providerId ===\r\n            firebase.auth.GoogleAuthProvider.PROVIDER_ID &&\r\n          providerData[i].uid === googleUser.getBasicProfile().getId()\r\n        ) {\r\n          // We don't need to reauth the Firebase connection.\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n  const onSignIn = (googleUser) => {\r\n    console.log(\"Google Auth Response\", googleUser);\r\n    // We need to register an Observer on Firebase Auth to make sure auth is initialized.\r\n    var unsubscribe = firebase\r\n      .auth()\r\n      .onAuthStateChanged(function (firebaseUser) {\r\n        unsubscribe();\r\n        // Check if we are already signed-in Firebase with the correct user.\r\n        if (!isUserEqual(googleUser, firebaseUser)) {\r\n          // Build Firebase credential with the Google ID token.\r\n          var credential = firebase.auth.GoogleAuthProvider.credential(\r\n            googleUser.idToken,\r\n            googleUser.accessToken\r\n          );\r\n          // Sign in with credential from the Google user.\r\n          firebase\r\n            .auth()\r\n            .signInAndRetrieveDataWithCredential(credential)\r\n            .then(function (result) {\r\n              console.log(\"user signed in \");\r\n              if (result.additionalUserInfo.isNewUser) {\r\n                firebase\r\n                  .database()\r\n                  .ref(\"/users/\" + result.user.uid)\r\n                  .set({\r\n                    gmail: result.user.email,\r\n                    profile_picture: result.additionalUserInfo.profile.picture,\r\n                    first_name: result.additionalUserInfo.profile.given_name,\r\n                    last_name: result.additionalUserInfo.profile.family_name,\r\n                    created_at: Date.now(),\r\n                  })\r\n                  .then(function (snapshot) {\r\n                    // console.log('Snapshot', snapshot);\r\n                  });\r\n              } else {\r\n                firebase\r\n                  .database()\r\n                  .ref(\"/users/\" + result.user.uid)\r\n                  .update({\r\n                    last_logged_in: Date.now(),\r\n                  });\r\n              }\r\n            })\r\n            .catch(function (error) {\r\n              // Handle Errors here.\r\n              var errorCode = error.code;\r\n              var errorMessage = error.message;\r\n              // The email of the user's account used.\r\n              var email = error.email;\r\n              // The firebase.auth.AuthCredential type that was used.\r\n              var credential = error.credential;\r\n              // ...\r\n            });\r\n        } else {\r\n          console.log(\"User already signed-in Firebase.\");\r\n        }\r\n      });\r\n  };\r\n  const signInWithGoogleAsync = async () => {\r\n    try {\r\n      const result = await Expo.Google.logInAsync({\r\n        // androidClientId: YOUR_CLIENT_ID_HERE,\r\n        behavior: \"web\",\r\n        iosClientId: \"\", //enter ios client id\r\n        scopes: [\"profile\", \"email\"],\r\n      });\r\n\r\n      if (result.type === \"success\") {\r\n        onSignIn(result);\r\n        return result.accessToken;\r\n      } else {\r\n        return { cancelled: true };\r\n      }\r\n    } catch (e) {\r\n      return { error: true };\r\n    }\r\n  };\r\n\r\n  return (\r\n    <View style={{ flex: 1, alignItems: \"center\", justifyContent: \"center\" }}>\r\n      <Button\r\n        title=\"Sign in with Google\"\r\n        onPress={() => {\r\n          signInWithGoogleAsync();\r\n        }}\r\n      />\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default Auth;\r\n"]},"metadata":{},"sourceType":"module"}